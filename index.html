<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cofit Daily Health Tracker</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Scrollbar Hide */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fade-in-up 0.3s ease-out forwards;
        }
    </style>
</head>

<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const {
            Plus, Calendar, Check, X,
            Activity, Droplet, Moon,
            Flame, Target, Pill, Footprints,
            Home, BookOpen, MessageSquare, ShoppingBag, Bell, User,
            ChevronLeft, ChevronRight, List, Edit2, Trash2,
            Repeat, Clock, Minus, Save, ArrowLeft, ChevronDown, ChevronUp,
            Utensils, Dumbbell, Zap, Star, Smile, Book, Award, Aperture, Sun, Heart, AirVent,
            TrendingUp, AlertCircle, Sparkles
        } = lucide;

        // --- Utility Functions ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const getTodayStr = () => new Date().toISOString().split('T')[0];

        // --- Constants ---
        const CATEGORY_CONFIG = {
            // Lucide Icons
            droplet: { type: 'icon', value: Droplet, color: 'text-blue-500', bg: 'bg-blue-50', label: 'È£≤Ê∞¥' },
            footprints: { type: 'icon', value: Footprints, color: 'text-pink-500', bg: 'bg-pink-50', label: 'Ê≠•Êï∏' },
            dumbbell: { type: 'icon', value: Dumbbell, color: 'text-orange-500', bg: 'bg-orange-50', label: 'ÈÅãÂãï' },
            moon: { type: 'icon', value: Moon, color: 'text-indigo-500', bg: 'bg-indigo-50', label: 'Áù°Áú†' },
            sun: { type: 'icon', value: Sun, color: 'text-yellow-500', bg: 'bg-yellow-50', label: 'ÈôΩÂÖâ' },
            pill: { type: 'icon', value: Pill, color: 'text-purple-500', bg: 'bg-purple-50', label: '‰øùÂÅ•' },
            aperture: { type: 'icon', value: Aperture, color: 'text-fuchsia-500', bg: 'bg-fuchsia-50', label: 'Á¥ÄÈåÑ' },

            // Emojis
            apple: { type: 'emoji', value: 'üçé', color: 'text-red-500', bg: 'bg-red-50', label: 'È£≤È£ü' },
            zap: { type: 'emoji', value: '‚ö°Ô∏è', color: 'text-yellow-500', bg: 'bg-yellow-50', label: 'Â∞àÊ≥®' },
            yoga: { type: 'emoji', value: 'üßò', color: 'text-green-500', bg: 'bg-green-50', label: 'ÂÜ•ÊÉ≥' },
            book: { type: 'icon', value: Book, color: 'text-amber-500', bg: 'bg-amber-50', label: 'Èñ±ËÆÄ' },
            money: { type: 'emoji', value: 'üí∞', color: 'text-lime-500', bg: 'bg-lime-50', label: 'ÁêÜË≤°' },
            journal: { type: 'emoji', value: '‚úçÔ∏è', color: 'text-sky-500', bg: 'bg-sky-50', label: 'Êó•Ë®ò' },
            star: { type: 'icon', value: Star, color: 'text-gray-500', bg: 'bg-gray-50', label: 'ÂÖ∂‰ªñ' },
        };

        const OFFICIAL_TASKS = [
            {
                id: 'template_water', type: 'quantitative', category: 'droplet',
                title: 'È£≤Ê∞¥ 2000 cc', dailyTarget: 2000, unit: 'cc', stepValue: 200, frequency: 'daily',
                details: 'ÁßëÂ≠∏Âª∫Ë≠∞ÊØèÊó•È£≤Ê∞¥ 2000ccÔºåÊúâÂä©ÊñºÊñ∞Èô≥‰ª£Ë¨ù„ÄÇ',
                science: 'È£≤Ê∞¥‰∏çË∂≥ÊúÉÂΩ±ÈüøËÖéËáüÂäüËÉΩÂèäÊ∂àÂåñÁ≥ªÁµ±„ÄÇ',
                tool: 'ÂÆöÊôÇÊèêÈÜí App (ÂèØÈÅ∏)', recommend: '200 cc / Ê¨°'
            },
            {
                id: 'template_steps', type: 'quantitative', category: 'footprints',
                title: 'ÂÅ•Ëµ∞ 8000 Ê≠•', dailyTarget: 8000, unit: 'Ê≠•', stepValue: 1000, frequency: 'daily',
                details: '‰∏ñÁïåË°õÁîüÁµÑÁπîÂª∫Ë≠∞ÔºåÊØèÊó•ÈÅî 8000 Ê≠•ÂèØÁ∂≠ÊåÅÂü∫Êú¨Ê¥ªÂãïÈáè„ÄÇ',
                science: 'Ë¶èÂæãÊ≠•Ë°åËÉΩÈôç‰ΩéÂøÉË°ÄÁÆ°ÁñæÁóÖÈ¢®Èö™„ÄÇ',
                tool: 'ÊâãÊ©üË®àÊ≠•Âô®', recommend: 'È£ØÂæåÊï£Ê≠• 20 ÂàÜÈêò'
            },
            {
                id: 'template_weekly_review', type: 'mission', category: 'journal',
                title: 'ÊØèÈÄ±ÂÅ•Â∫∑ÂõûÈ°ß', frequency: 'weekly',
                details: 'Ê™¢Ë¶ñÊú¨ÈÄ±ÁöÑÈ£≤È£üËàáÈÅãÂãïÁãÄÊ≥ÅÔºåË™øÊï¥‰∏ãÈÄ±Ë®àÁï´„ÄÇ',
                science: 'ÂÆöÊúüÂõûÈ°ßËÉΩÊèêÂçáÁõÆÊ®ôÈÅîÊàêÁéá 40%„ÄÇ',
                tool: 'Á≠ÜË®òÊú¨', recommend: 'ÈÄ±Êó•Êôö‰∏ä'
            },
        ];

        // --- Mock Data ---
        const initialTasks = [
            {
                id: 't1', frequency: 'daily', type: 'quantitative', category: 'footprints',
                title: 'Ëµ∞ 8000 Ê≠•', dailyTarget: 8000, unit: 'Ê≠•', stepValue: 1000,
                details: 'ÁõÆÊ®ôÊòØÊØèÊó• 8000 Ê≠•ÔºåÈ£ØÂæåÊï£Ê≠•ÊòØÂ•ΩÂπ´Êâã„ÄÇ',
                dailyProgress: { [getTodayStr()]: { value: 4500, completed: false } },
                recurrence: { type: 'daily', interval: 1 },
                reminder: { type: 'smart', time: '20:00', condition: 'if_incomplete' },
                history: { '2025-11-26': true, '2025-11-27': true }
            },
            {
                id: 't2', frequency: 'daily', type: 'quantitative', category: 'droplet',
                title: 'ÂñùÊ∞¥ 1800 cc', dailyTarget: 1800, unit: 'cc', stepValue: 200,
                details: 'ÂàÜÊâπÂ∞èÂè£ÂñùÊ∞¥ÔºåÂÆöÊôÇÊèêÈÜíËá™Â∑±„ÄÇ',
                dailyProgress: { [getTodayStr()]: { value: 1200, completed: false } },
                recurrence: { type: 'daily', interval: 1 },
                reminder: { type: 'fixed', time: '10:00' },
                history: { '2025-11-26': false }
            },
            {
                id: 't3', frequency: 'daily', type: 'checklist', category: 'pill',
                title: 'ÊúçÁî®‰øùÂÅ•È£üÂìÅ',
                details: 'Ë´ãÂú®Êó©È§êÊàñÂçàÈ§êÂæåÊúçÁî®„ÄÇ',
                subtasks: [
                    { id: 's1', title: 'È≠öÊ≤π', completed: true },
                    { id: 's2', title: 'Á∂≠ÁîüÁ¥† B', completed: false },
                ],
                completed: false,
                recurrence: { type: 'daily', interval: 1 },
                history: {}
            },
            {
                id: 't4', frequency: 'weekly', type: 'mission', category: 'aperture',
                title: '‰∏äÂÇ≥Êú¨ÈÄ±È´îÊÖãÁÖßÁâá', completed: false, date: '2025-11-30',
                details: 'Ë´ãÂú®ÈÄ±Êú´Ââç‰∏äÂÇ≥Ê≠£Èù¢„ÄÅÂÅ¥Èù¢„ÄÅËÉåÈù¢„ÄÇ', subtasks: [],
                recurrence: { type: 'weekly', interval: 1 },
                history: {}
            },
            {
                id: 't6', frequency: 'monthly', type: 'mission', category: 'target',
                title: 'Ë®≠ÂÆö‰∏ãÊúàÈ´îËÑÇÁõÆÊ®ô', completed: false, date: '2025-11-30',
                details: 'Ê™¢Ë¶ñÊú¨ÊúàÊàêÊûúÔºåË®≠ÂÆöÊñ∞ÁöÑÊåëÊà∞„ÄÇ', subtasks: [],
                recurrence: { type: 'monthly', interval: 1 },
                history: {}
            },
        ];

        // --- Helper Components ---

        const IconRenderer = ({ category, size = 18, className = '' }) => {
            const config = CATEGORY_CONFIG[category] || CATEGORY_CONFIG['star'];
            if (config.type === 'icon') {
                const Icon = config.value;
                return <Icon size={size} className={`${config.color} ${className}`} />;
            }
            return (
                <span className={`text-${size / 4}xl ${className}`} style={{ fontSize: `${size}px` }}>
                    {config.value}
                </span>
            );
        };

        // 1. App Header
        const AppHeader = ({ onViewChange, currentView, onOpenAddFlow, onOpenBadges }) => {
            const weekDays = ['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'];

            return (
                <div className="bg-white sticky top-0 z-30 shadow-sm">
                    <div className="flex items-center justify-between px-4 py-3">
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => onViewChange('daily')}>
                            <div className="w-8 h-8 rounded-full bg-gray-200 overflow-hidden border border-gray-100">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar" className="w-full h-full" />
                            </div>
                            <span className="font-bold text-gray-800 text-sm md:text-base">ÁÅ´ÁÑ∞ÈòøÊ∑≥ üî•</span>
                        </div>

                        {currentView === 'daily' ? (
                            <div className="flex items-center gap-2">
                                <Calendar size={18} className="text-gray-600" />
                                <span className="font-bold text-gray-800 text-sm md:text-base">11/28 (‰∫î)</span>
                            </div>
                        ) : (
                            <span className="font-bold text-emerald-600">
                                {currentView === 'manage' ? '‰ªªÂãôÁÆ°ÁêÜ' : currentView === 'dashboard_detail' ? 'Ê¥ûÂØüÂ†±Âëä' : 'ÊàêÂ∞±‰∏≠ÂøÉ'}
                            </span>
                        )}

                        <div className="flex gap-2">
                            {currentView === 'daily' && (
                                <>
                                    <button onClick={onOpenBadges} className="w-8 h-8 bg-gray-100 text-yellow-600 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors">
                                        <Award size={20} />
                                    </button>
                                    <button onClick={onOpenAddFlow} className="w-8 h-8 bg-emerald-50 text-emerald-600 rounded-lg flex items-center justify-center hover:bg-emerald-100 transition-colors">
                                        <Plus size={20} />
                                    </button>
                                </>
                            )}
                            {(currentView !== 'daily' && currentView !== 'dashboard_detail') && (
                                <button onClick={() => onViewChange('daily')} className="w-8 h-8 bg-emerald-50 text-emerald-600 rounded-lg flex items-center justify-center hover:bg-emerald-100 transition-colors">
                                    <Calendar size={20} />
                                </button>
                            )}
                            {currentView === 'dashboard_detail' && (
                                <button onClick={() => onViewChange('daily')} className="w-8 h-8 bg-gray-100 text-gray-600 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors">
                                    <X size={20} />
                                </button>
                            )}
                            {currentView === 'manage' && (
                                <button onClick={onOpenAddFlow} className="w-8 h-8 bg-gray-900 rounded-lg flex items-center justify-center text-white hover:bg-gray-700 transition-colors">
                                    <Plus size={20} />
                                </button>
                            )}
                        </div>
                    </div>

                    {/* Week Strip */}
                    {currentView === 'daily' && (
                        <div className="flex justify-between items-center px-2 md:px-6 pb-0 overflow-x-auto no-scrollbar">
                            {weekDays.map((day, index) => {
                                const isSelected = index === 4;
                                return (
                                    <div key={index} className={`flex flex-col items-center justify-center py-2 px-3 md:px-6 cursor-pointer relative min-w-[3rem] ${isSelected ? 'text-emerald-600 font-bold' : 'text-gray-400 font-medium'}`}>
                                        <span className="text-sm">{day}</span>
                                        {isSelected && <div className="absolute bottom-0 w-full h-[3px] bg-emerald-500 rounded-t-full"></div>}
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };

        // 2. Task Card
        const TaskCard = ({ task, onClick, onUpdate }) => {
            const isCompleted = task.type === 'quantitative'
                ? (task.dailyProgress[getTodayStr()]?.value || 0) >= task.dailyTarget
                : task.completed;

            const config = CATEGORY_CONFIG[task.category] || CATEGORY_CONFIG['star'];
            const currentVal = task.type === 'quantitative' ? (task.dailyProgress[getTodayStr()]?.value || 0) : 0;
            const targetVal = task.type === 'quantitative' ? task.dailyTarget : 0;
            const stepVal = task.type === 'quantitative' ? task.stepValue || 1 : 0;
            const percent = targetVal > 0 ? Math.min(100, Math.round((currentVal / targetVal) * 100)) : 0;

            return (
                <div onClick={onClick} className={`bg-white p-4 rounded-2xl border transition-all cursor-pointer relative overflow-hidden shadow-sm hover:shadow-md ${isCompleted ? 'border-emerald-200 bg-emerald-50/30' : 'border-gray-100'}`}>
                    {/* Progress Bar Background */}
                    {(task.type === 'quantitative') && (
                        <div
                            className={`absolute bottom-0 left-0 h-1 transition-all duration-700 ${isCompleted ? 'bg-gradient-to-r from-yellow-400 to-emerald-500' : 'bg-emerald-400'}`}
                            style={{ width: `${percent}%` }}
                        />
                    )}

                    <div className="flex justify-between items-start mb-2">
                        <div className="flex items-center gap-3">
                            <div className={`${config.bg} p-2 rounded-xl`}>
                                <IconRenderer category={task.category} size={18} className={config.type === 'emoji' ? 'text-2xl' : ''} />
                            </div>
                            <div>
                                <h3 className={`font-bold text-sm ${isCompleted && task.type !== 'quantitative' ? 'text-gray-400 line-through' : 'text-gray-800'}`}>
                                    {task.title}
                                </h3>
                                <p className="text-xs text-gray-400 line-clamp-1">{task.details || 'ÁÑ°Ë©≥Á¥∞Ë™™Êòé'}</p>
                            </div>
                        </div>

                        <div className="flex flex-col items-end gap-1">
                            {task.type === 'quantitative' ? (
                                <span className={`text-xs font-bold px-2 py-1 rounded-lg whitespace-nowrap transition-colors ${isCompleted ? 'bg-yellow-100 text-yellow-700' : 'bg-emerald-50 text-emerald-600'}`}>
                                    {isCompleted ? 'üéâ ÈÅîÊàê' : `${currentVal}/${targetVal} ${task.unit}`}
                                </span>
                            ) : (
                                <button
                                    onClick={(e) => { e.stopPropagation(); onUpdate(task, 'toggle'); }}
                                    className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${isCompleted ? 'bg-emerald-500 border-emerald-500' : 'border-gray-200 hover:border-emerald-400'}`}
                                >
                                    {isCompleted && <Check size={14} className="text-white" strokeWidth={3} />}
                                </button>
                            )}
                        </div>
                    </div>

                    {task.type === 'quantitative' && (
                        <div className="flex justify-end gap-2 mt-2">
                            <button onClick={(e) => { e.stopPropagation(); onUpdate(task, 'add', -stepVal); }} className="w-8 h-6 flex items-center justify-center text-xs font-bold text-gray-500 hover:bg-gray-100 rounded-full border border-gray-200 transition-colors"><Minus size={12} /></button>
                            <button onClick={(e) => { e.stopPropagation(); onUpdate(task, 'add', stepVal); }} className="w-12 h-6 flex items-center justify-center text-xs font-bold text-emerald-600 hover:bg-emerald-50 rounded-full border border-emerald-100 transition-colors">+{stepVal}</button>
                            <span className="text-xs text-gray-400 pt-1.5">{task.unit}</span>
                        </div>
                    )}
                </div>
            );
        };

        // 3. Task Form Modal
        const TaskFormModal = ({ isOpen, onClose, onSave, onDelete, initialData }) => {
            const [formData, setFormData] = useState({
                title: '', details: '', type: 'binary', category: 'star', frequency: 'daily',
                date: getTodayStr(), dailyTarget: 10, unit: 'Ê¨°', stepValue: 1, subtasks: [],
                recurrence: { type: 'daily', interval: 1, endType: 'never', endDate: '', endCount: 10 },
                reminder: { type: 'none', time: '09:00', condition: 'none' }
            });

            const [customEmoji, setCustomEmoji] = useState('');
            const [activeTab, setActiveTab] = useState('basic');
            const iconContainerRef = useRef(null);

            useEffect(() => {
                if (isOpen) {
                    if (initialData) {
                        setFormData({
                            ...initialData,
                            recurrence: { type: 'daily', interval: 1, endType: 'never', endDate: '', endCount: 10, ...(initialData.recurrence || {}) },
                            reminder: { type: 'none', time: '09:00', condition: 'none', ...(initialData.reminder || {}) },
                            stepValue: initialData.stepValue || 1,
                            subtasks: initialData.subtasks || []
                        });
                    } else {
                        setFormData({
                            title: '', details: '', type: 'binary', category: 'star', frequency: 'daily',
                            date: getTodayStr(), dailyTarget: 10, unit: 'Ê¨°', stepValue: 1, subtasks: [],
                            recurrence: { type: 'daily', interval: 1, endType: 'never', endDate: '', endCount: 10 },
                            reminder: { type: 'none', time: '09:00', condition: 'none' }
                        });
                    }
                    setActiveTab('basic');
                }
            }, [isOpen, initialData]);

            const scrollIcons = (direction) => {
                if (iconContainerRef.current) {
                    iconContainerRef.current.scrollBy({ left: direction === 'left' ? -150 : 150, behavior: 'smooth' });
                }
            };

            if (!isOpen) return null;

            const handleSubtaskChange = (idx, field, value) => {
                const newSub = [...formData.subtasks];
                newSub[idx][field] = value;
                setFormData({ ...formData, subtasks: newSub });
            };

            const addSubtask = () => {
                setFormData({
                    ...formData,
                    type: 'checklist',
                    subtasks: [...formData.subtasks, { id: generateId(), title: '', completed: false }]
                });
            };

            const removeSubtask = (idx) => {
                setFormData({ ...formData, subtasks: formData.subtasks.filter((_, i) => i !== idx) });
            };

            const handleAddCustomEmoji = () => {
                if (customEmoji && customEmoji.length <= 2) {
                    const newKey = `custom_${generateId()}`;
                    CATEGORY_CONFIG[newKey] = { type: 'emoji', value: customEmoji, color: 'text-gray-900', bg: 'bg-yellow-100', label: 'Ëá™Ë®Ç' };
                    setFormData({ ...formData, category: newKey });
                    setCustomEmoji('');
                }
            }

            const selectedConfig = CATEGORY_CONFIG[formData.category] || CATEGORY_CONFIG['star'];

            return (
                <div className="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-end md:items-center justify-center">
                    <div className="bg-white w-full md:max-w-md h-[90vh] md:h-auto md:rounded-2xl rounded-t-2xl shadow-2xl flex flex-col animate-fade-in-up">

                        <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-white rounded-t-2xl">
                            <div className="flex items-center gap-2">
                                <button onClick={onClose}><X size={24} className="text-gray-500" /></button>
                                <h3 className="font-bold text-lg text-gray-800">{initialData ? 'Á∑®ËºØ‰ªªÂãô' : 'Êñ∞Â¢û‰ªªÂãô'}</h3>
                            </div>
                            <button onClick={() => onSave(formData)} className="text-emerald-600 font-bold text-sm px-4 py-2 bg-emerald-50 rounded-full hover:bg-emerald-100">
                                ÂÑ≤Â≠ò
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto p-6 space-y-6">

                            {/* Title & Icon */}
                            <div className="flex items-center gap-3">
                                <div className={`${selectedConfig.bg} p-2 rounded-xl flex-shrink-0`}>
                                    <IconRenderer category={formData.category} size={24} className={selectedConfig.type === 'emoji' ? 'text-3xl' : ''} />
                                </div>
                                <input
                                    className="w-full text-2xl font-bold text-gray-800 placeholder-gray-300 focus:outline-none"
                                    placeholder="‰ªªÂãôÂêçÁ®± (‰æãÂ¶Ç: ÂñùÊ∞¥)"
                                    value={formData.title}
                                    onChange={e => setFormData({ ...formData, title: e.target.value })}
                                />
                            </div>

                            {/* Icon Selector */}
                            <div className="relative group">
                                <label className="text-xs text-gray-400 block mb-2 font-bold uppercase">ÈÅ∏ÊìáÂúñÁ§∫</label>
                                <div className="flex items-center">
                                    <button onClick={() => scrollIcons('left')} className="hidden md:block p-1 text-gray-400 hover:text-gray-600 bg-white shadow-sm rounded-full absolute left-0 z-10"><ChevronLeft size={16} /></button>
                                    <div ref={iconContainerRef} className="flex gap-3 overflow-x-auto no-scrollbar py-1 px-1 w-full scroll-smooth">
                                        <div className="flex-shrink-0 min-w-[4.5rem] p-2 rounded-lg bg-gray-50 flex flex-col items-center justify-center border-2 border-dashed border-gray-300">
                                            <input
                                                className="w-8 h-8 text-xl text-center bg-transparent focus:outline-none"
                                                placeholder="üòÄ" maxLength={2} value={customEmoji}
                                                onChange={e => setCustomEmoji(e.target.value)}
                                                onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); handleAddCustomEmoji(); } }}
                                            />
                                        </div>
                                        {Object.entries(CATEGORY_CONFIG).map(([key, config]) => {
                                            const isSelected = formData.category === key;
                                            const IconComp = config.type === 'icon' ? config.value : null;
                                            return (
                                                <div key={key} onClick={() => setFormData({ ...formData, category: key })} className={`flex flex-col items-center gap-1 cursor-pointer min-w-[3.5rem] p-2 rounded-lg transition-all flex-shrink-0 ${isSelected ? 'bg-emerald-50 border-2 border-emerald-500' : 'bg-gray-100 hover:bg-gray-200'}`}>
                                                    <div className="w-8 h-8 flex items-center justify-center">
                                                        {config.type === 'icon' ? <IconComp size={20} className={config.color} /> : <span className="text-2xl">{config.value}</span>}
                                                    </div>
                                                    <span className="text-[10px] text-gray-500 font-medium">{config.label}</span>
                                                </div>
                                            )
                                        })}
                                    </div>
                                    <button onClick={() => scrollIcons('right')} className="hidden md:block p-1 text-gray-400 hover:text-gray-600 bg-white shadow-sm rounded-full absolute right-0 z-10"><ChevronRight size={16} /></button>
                                </div>
                            </div>

                            {/* Frequency Type */}
                            <div className="flex gap-2 p-1 bg-gray-100 rounded-xl">
                                {['daily', 'weekly', 'monthly'].map(freq => (
                                    <button
                                        key={freq}
                                        onClick={() => setFormData({ ...formData, frequency: freq })}
                                        className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${formData.frequency === freq ? 'bg-white text-emerald-600 shadow-sm' : 'text-gray-500 hover:bg-gray-200'}`}
                                    >
                                        {freq === 'daily' ? 'ÊØèÊó•' : freq === 'weekly' ? 'ÊØèÈÄ±' : 'ÊØèÊúà'}
                                    </button>
                                ))}
                            </div>

                            {/* Type & Goal */}
                            <div className="pt-2">
                                <div className="flex gap-2 mb-4 overflow-x-auto no-scrollbar">
                                    {[
                                        { id: 'binary', label: '‰∏ÄËà¨ (ÈÅîÊàê/Êú™ÈÅîÊàê)' },
                                        { id: 'quantitative', label: 'Ë®àÈáè (Ê≠•Êï∏/cc)' },
                                        { id: 'checklist', label: 'Ê∏ÖÂñÆ (Â≠ê‰ªªÂãô)' }
                                    ].map(type => (
                                        <button key={type.id} onClick={() => setFormData({ ...formData, type: type.id })} className={`px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-colors ${formData.type === type.id ? 'bg-gray-800 text-white' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}`}>
                                            {type.label}
                                        </button>
                                    ))}
                                </div>

                                {formData.type === 'quantitative' && (
                                    <div className="flex flex-col gap-3 bg-blue-50 p-4 rounded-xl border border-blue-100">
                                        <div className="flex gap-3">
                                            <div className="flex-1">
                                                <label className="text-xs text-blue-600 block mb-1 font-bold">ÁõÆÊ®ôÊï∏ÂÄº</label>
                                                <input type="number" className="w-full bg-white border border-blue-200 rounded-lg px-3 py-2 text-sm" value={formData.dailyTarget} onChange={e => setFormData({ ...formData, dailyTarget: parseInt(e.target.value) })} />
                                            </div>
                                            <div className="w-24">
                                                <label className="text-xs text-blue-600 block mb-1 font-bold">ÂñÆ‰Ωç</label>
                                                <input type="text" placeholder="cc" className="w-full bg-white border border-blue-200 rounded-lg px-3 py-2 text-sm" value={formData.unit} onChange={e => setFormData({ ...formData, unit: e.target.value })} />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="text-xs text-blue-600 block mb-1 font-bold">ÊØèÊ¨°Â¢ûÈáè (‰æãÂ¶Ç +200)</label>
                                            <input type="number" className="w-full bg-white border border-blue-200 rounded-lg px-3 py-2 text-sm" value={formData.stepValue} onChange={e => setFormData({ ...formData, stepValue: parseInt(e.target.value) })} />
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Subtasks */}
                            {(formData.type === 'checklist' || formData.subtasks.length > 0) && (
                                <div className="space-y-3">
                                    <label className="text-xs text-gray-400 font-bold uppercase">Â≠ê‰ªªÂãôÊ∏ÖÂñÆ</label>
                                    {formData.subtasks.map((sub, idx) => (
                                        <div key={sub.id} className="flex items-center gap-2">
                                            <input type="checkbox" disabled className="w-4 h-4 rounded border-gray-300" />
                                            <input
                                                className="flex-1 bg-gray-50 border-b border-transparent focus:border-emerald-500 focus:bg-white outline-none px-2 py-1 text-sm transition-colors"
                                                value={sub.title} placeholder="Ëº∏ÂÖ•È†ÖÁõÆ..." autoFocus={idx === formData.subtasks.length - 1}
                                                onChange={e => handleSubtaskChange(idx, 'title', e.target.value)}
                                                onKeyDown={(e) => { if (e.key === 'Enter') { e.preventDefault(); addSubtask(); } }}
                                            />
                                            <button onClick={() => removeSubtask(idx)} className="text-gray-400 hover:text-red-500"><X size={16} /></button>
                                        </div>
                                    ))}
                                    <button onClick={addSubtask} className="flex items-center gap-2 text-sm text-emerald-600 font-bold hover:text-emerald-700 mt-2">
                                        <Plus size={16} /> Êñ∞Â¢ûÂ≠ê‰ªªÂãô
                                    </button>
                                </div>
                            )}

                            {/* Advanced Settings */}
                            <div className="border-t border-gray-100 pt-4">
                                <button
                                    onClick={() => setActiveTab(activeTab === 'advance' ? 'basic' : 'advance')}
                                    className="flex items-center justify-between w-full text-sm font-bold text-gray-600 mb-3"
                                >
                                    <span className="flex items-center gap-2"><Clock size={16} /> ÊèêÈÜíËàáÈáçË§áË®≠ÂÆö</span>
                                    {activeTab === 'advance' ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                                </button>

                                {activeTab === 'advance' && (
                                    <div className="bg-gray-50 p-4 rounded-xl space-y-4 animate-fade-in-down">

                                        {/* Reminder Settings (Smart) */}
                                        <div>
                                            <label className="text-xs text-gray-500 block mb-2 font-bold">üîî ÊèêÈÜíË®≠ÂÆö</label>
                                            <div className="flex gap-2 mb-2">
                                                <button
                                                    onClick={() => setFormData({ ...formData, reminder: { ...formData.reminder, type: 'fixed' } })}
                                                    className={`flex-1 py-1.5 text-xs rounded border ${formData.reminder.type === 'fixed' ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-600 border-gray-200'}`}
                                                >
                                                    Âõ∫ÂÆöÊôÇÈñì
                                                </button>
                                                <button
                                                    onClick={() => setFormData({ ...formData, reminder: { ...formData.reminder, type: 'smart' } })}
                                                    className={`flex-1 py-1.5 text-xs rounded border ${formData.reminder.type === 'smart' ? 'bg-purple-500 text-white border-purple-500' : 'bg-white text-gray-600 border-gray-200'}`}
                                                >
                                                    Êô∫ÊÖßÊèêÈÜí (Ëã•Êú™ÂÆåÊàê)
                                                </button>
                                                <button
                                                    onClick={() => setFormData({ ...formData, reminder: { ...formData.reminder, type: 'none' } })}
                                                    className={`flex-1 py-1.5 text-xs rounded border ${formData.reminder.type === 'none' ? 'bg-gray-500 text-white border-gray-500' : 'bg-white text-gray-600 border-gray-200'}`}
                                                >
                                                    ÈóúÈñâ
                                                </button>
                                            </div>
                                            {formData.reminder.type !== 'none' && (
                                                <div className="flex items-center gap-3 bg-white p-2 rounded border border-gray-200">
                                                    <Clock size={16} className="text-gray-400" />
                                                    <input
                                                        type="time"
                                                        className="outline-none text-sm text-gray-800 bg-transparent flex-1"
                                                        value={formData.reminder.time}
                                                        onChange={e => setFormData({ ...formData, reminder: { ...formData.reminder, time: e.target.value } })}
                                                    />
                                                    {formData.reminder.type === 'smart' && (
                                                        <span className="text-[10px] text-purple-500 bg-purple-50 px-2 py-0.5 rounded">
                                                            ÂÉÖÂú®Êú™ÂÆåÊàêÊôÇÈÄöÁü•
                                                        </span>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        <div className="border-t border-gray-200 my-2"></div>

                                        {/* Recurrence Settings */}
                                        <div>
                                            <label className="text-xs text-gray-500 block mb-2 font-bold">üîÅ ÈáçË§áËàáÁµêÊùü</label>
                                            <div className="flex gap-2">
                                                <select
                                                    className="bg-white border border-gray-200 text-sm rounded-lg px-3 py-2 flex-1 outline-none"
                                                    value={formData.recurrence.type}
                                                    onChange={e => setFormData({ ...formData, recurrence: { ...formData.recurrence, type: e.target.value } })}
                                                >
                                                    <option value="daily">ÊØèÂ§©ÈáçË§á</option>
                                                    <option value="weekly">ÊØèÈÄ±ÈáçË§á</option>
                                                    <option value="monthly">ÊØèÊúàÈáçË§á</option>
                                                    <option value="once">‰∏çÈáçË§á (ÂñÆÊ¨°)</option>
                                                </select>
                                            </div>
                                        </div>

                                        {formData.recurrence.type !== 'once' && (
                                            <div className="pt-2">
                                                <div className="flex gap-2 mb-2">
                                                    {['never', 'date'].map(type => (
                                                        <button
                                                            key={type}
                                                            onClick={() => setFormData({ ...formData, recurrence: { ...formData.recurrence, endType: type } })}
                                                            className={`px-3 py-1 text-xs rounded border ${formData.recurrence.endType === type ? 'bg-emerald-500 text-white border-emerald-500' : 'bg-white text-gray-600 border-gray-200'}`}
                                                        >
                                                            {type === 'never' ? 'Ê∞∏‰∏çÂÅúÊ≠¢' : 'Áõ¥Âà∞Êó•Êúü'}
                                                        </button>
                                                    ))}
                                                </div>
                                                {formData.recurrence.endType === 'date' && (
                                                    <input type="date" className="w-full bg-white border border-gray-200 rounded px-3 py-2 text-sm" value={formData.recurrence.endDate} onChange={e => setFormData({ ...formData, recurrence: { ...formData.recurrence, endDate: e.target.value } })} />
                                                )}
                                            </div>
                                        )}
                                    </div>
                                )}
                            </div>

                            {/* Details */}
                            <div>
                                <label className="text-xs text-gray-400 block mb-1 font-bold uppercase">ÂÇôË®ªË™™Êòé</label>
                                <textarea
                                    className="w-full bg-gray-50 border-none rounded-xl p-3 text-sm text-gray-600 focus:ring-1 focus:ring-emerald-500 resize-none"
                                    placeholder="ÂØ´Èªû‰ªÄÈ∫º..." rows={3}
                                    value={formData.details}
                                    onChange={e => setFormData({ ...formData, details: e.target.value })}
                                />
                            </div>

                        </div>

                        {/* Footer */}
                        {initialData && (
                            <div className="p-4 border-t border-gray-100 bg-gray-50 rounded-b-2xl flex justify-between items-center">
                                <span className="text-xs text-gray-400">ID: {initialData.id}</span>
                                <button onClick={() => onDelete(initialData.id)} className="text-red-500 flex items-center gap-1 text-sm font-bold hover:bg-red-50 px-3 py-1 rounded-lg transition-colors">
                                    <Trash2 size={16} /> Âà™Èô§
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 4. Task Library Modal
        const TaskLibraryModal = ({ isOpen, onClose, onSelectTask, onOpenCustomForm }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-50 bg-black bg-opacity-50 flex items-end md:items-center justify-center">
                    <div className="bg-white w-full md:max-w-xl h-[90vh] md:h-auto md:rounded-2xl rounded-t-2xl shadow-2xl flex flex-col animate-fade-in-up">
                        <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center">
                            <h3 className="font-bold text-lg text-gray-800 flex items-center gap-2"><Target size={20} className="text-emerald-500" /> ÂÆòÊñπ‰ªªÂãôÊ∏ÖÂñÆÂ∫´</h3>
                            <button onClick={onClose}><X size={24} className="text-gray-500 hover:text-gray-800" /></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-6 space-y-4">
                            <button onClick={onOpenCustomForm} className="w-full bg-gray-800 text-white text-base font-bold py-3 rounded-xl shadow-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2 mb-6">
                                <Edit2 size={20} /> ÊâãÂãïÂª∫Á´ãÊñ∞‰ªªÂãô
                            </button>
                            <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Êé®Ëñ¶Ê®°Êùø</p>
                            <div className="space-y-3">
                                {OFFICIAL_TASKS.map(task => {
                                    const config = CATEGORY_CONFIG[task.category] || CATEGORY_CONFIG['star'];
                                    return (
                                        <div key={task.id} className="bg-white border border-gray-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow">
                                            <div className="flex justify-between items-start">
                                                <div className="flex items-center gap-3">
                                                    <div className={`${config.bg} p-2 rounded-xl flex-shrink-0`}>
                                                        <IconRenderer category={task.category} size={18} className={config.type === 'emoji' ? 'text-2xl' : ''} />
                                                    </div>
                                                    <div>
                                                        <h4 className="font-bold text-gray-800">{task.title}</h4>
                                                        <p className="text-xs text-gray-400 line-clamp-2 mt-0.5">{task.details}</p>
                                                    </div>
                                                </div>
                                                <button onClick={() => onSelectTask(task)} className="flex items-center gap-1 text-sm text-white bg-emerald-500 px-3 py-1.5 rounded-full font-bold hover:bg-emerald-600 transition-colors flex-shrink-0">
                                                    <Plus size={16} /> Êñ∞Â¢û
                                                </button>
                                            </div>
                                            <div className="mt-3 pt-3 border-t border-gray-100 space-y-1">
                                                <p className="text-xs text-gray-600"><span className="font-bold text-emerald-600">üí°ÁßëÂ≠∏‰æùÊìö:</span> {task.science}</p>
                                                <p className="text-xs text-gray-600"><span className="font-bold text-gray-600">üõ†Ô∏èÂ∑•ÂÖ∑:</span> {task.tool} ({task.recommend})</p>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. Dashboard Summary Card (New: Health Score)
        const DashboardSummaryCard = ({ tasks, onOpenDetail }) => {
            const dailyTasks = tasks.filter(t => t.frequency === 'daily');

            // Calculate Score (Behavioral Science Logic: All tasks matter)
            const totalTasks = dailyTasks.length;
            let score = 0;

            dailyTasks.forEach(t => {
                if (t.type === 'quantitative') {
                    const curr = t.dailyProgress[getTodayStr()]?.value || 0;
                    const target = t.dailyTarget || 1;
                    const ratio = Math.min(1, curr / target);
                    score += (100 / totalTasks) * ratio;
                } else {
                    score += t.completed ? (100 / totalTasks) : 0;
                }
            });

            const finalScore = Math.round(score);

            return (
                <div
                    onClick={onOpenDetail}
                    className="bg-gradient-to-br from-emerald-600 to-teal-800 rounded-3xl p-6 text-white shadow-lg mb-6 relative overflow-hidden cursor-pointer hover:shadow-xl transition-all"
                >
                    <div className="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full transform translate-x-10 -translate-y-10"></div>
                    <div className="relative z-10 flex items-center justify-between">
                        <div>
                            <p className="text-emerald-100 font-bold text-sm mb-1 flex items-center gap-1"><Sparkles size={14} /> ‰ªäÊó•ÂÅ•Â∫∑ÂàÜÊï∏</p>
                            <h2 className="text-4xl font-black">{finalScore} <span className="text-lg font-medium opacity-70">/ 100</span></h2>
                            <p className="text-xs text-emerald-100 mt-2 opacity-80">ÈªûÊìäÊü•ÁúãË©≥Á¥∞Ê¥ûÂØüÂ†±Âëä &rarr;</p>
                        </div>

                        {/* Circular Progress (Simple CSS) */}
                        <div className="relative w-20 h-20 flex items-center justify-center">
                            <svg className="transform -rotate-90 w-full h-full">
                                <circle cx="40" cy="40" r="36" stroke="currentColor" strokeWidth="8" fill="transparent" className="text-white/20" />
                                <circle cx="40" cy="40" r="36" stroke="currentColor" strokeWidth="8" fill="transparent" className="text-white transition-all duration-1000 ease-out" strokeDasharray={`${2 * Math.PI * 36}`} strokeDashoffset={`${2 * Math.PI * 36 * (1 - finalScore / 100)}`} strokeLinecap="round" />
                            </svg>
                            <span className="absolute text-xl font-bold">{finalScore}%</span>
                        </div>
                    </div>
                </div>
            );
        };

        // 6. Dashboard Detail View (New: Insight & Charts)
        const DashboardDetailView = ({ tasks }) => {
            // Mock Week Data Generation
            const weekData = [45, 60, 55, 80, 70, 90, 65]; // Percentages
            const maxVal = 100;

            return (
                <div className="p-4 md:p-8 max-w-4xl mx-auto pb-24 animate-fade-in-up">
                    <h2 className="text-2xl font-black text-gray-800 mb-6 flex items-center gap-2">
                        <Activity className="text-emerald-600" /> ÂÅ•Â∫∑Ê¥ûÂØüÂ†±Âëä
                    </h2>

                    {/* Weekly Trend Chart */}
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 mb-6">
                        <h3 className="font-bold text-gray-700 mb-4">Êú¨ÈÄ±ÂÆåÊàêÁéáË∂®Âã¢</h3>
                        <div className="flex items-end justify-between h-40 gap-2">
                            {['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'].map((d, i) => (
                                <div key={i} className="flex-1 flex flex-col items-center gap-2">
                                    <div className="w-full bg-gray-100 rounded-t-lg relative flex-1 overflow-hidden">
                                        <div
                                            className={`absolute bottom-0 w-full rounded-t-lg transition-all duration-1000 ${weekData[i] > 80 ? 'bg-emerald-500' : 'bg-emerald-300'}`}
                                            style={{ height: `${weekData[i]}%` }}
                                        ></div>
                                    </div>
                                    <span className="text-xs text-gray-400 font-bold">{d}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* AI Coach Insight */}
                    <div className="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-100 relative">
                        <div className="absolute top-4 right-4 bg-white p-2 rounded-full shadow-sm">
                            <MessageSquare size={20} className="text-blue-500" />
                        </div>
                        <h3 className="font-bold text-blue-900 mb-2">üí° ÂÅ•Â∫∑ÊïôÁ∑¥ÈªûË©ï</h3>
                        <p className="text-sm text-blue-800 leading-relaxed">
                            „Äå‰Ω†ÈÄôÈÄ±Âú® <span className="font-bold">È£≤Ê∞¥</span> ÊñπÈù¢Ë°®ÁèæÈùûÂ∏∏Á©©ÂÆöÔºåÈÄ£Á∫å‰∏âÂ§©ÈÅîÊ®ôÔºÅ‰∏çÈÅé <span className="font-bold">Áù°Áú†</span> ÊôÇÈñì‰ºº‰πéÊúâ‰∫õ‰∏çË¶èÂæã„ÄÇÂª∫Ë≠∞‰ªäÊôöË©¶ËëóË®≠ÂÆö‰∏ÄÂÄã 10:30 ÁöÑ„ÄéÁù°ÂâçÂÑÄÂºè„ÄèÊèêÈÜíÔºåÈÄôËÉΩÂπ´Âä©‰Ω†ÊèêÂçá 20% ÁöÑÊ∑±Â±§Áù°Áú†ÂìÅË≥™Âñî„ÄÇ„Äç
                        </p>
                    </div>
                </div>
            );
        }

        // 7. Main App
        const App = () => {
            const [tasks, setTasks] = useState(initialTasks);
            const [currentView, setCurrentView] = useState('daily');
            const [isFormModalOpen, setIsFormModalOpen] = useState(false);
            const [isLibraryModalOpen, setIsLibraryModalOpen] = useState(false);
            const [editingTask, setEditingTask] = useState(null);

            const handleUpdateProgress = (task, action, value) => {
                setTasks(prev => prev.map(t => {
                    if (t.id !== task.id) return t;
                    const todayStr = getTodayStr();

                    if (t.type === 'quantitative') {
                        const current = t.dailyProgress[todayStr]?.value || 0;
                        const newVal = Math.max(0, current + (value || 0));
                        const completedStatus = newVal >= t.dailyTarget;
                        return {
                            ...t,
                            dailyProgress: { ...t.dailyProgress, [todayStr]: { value: newVal, completed: completedStatus } },
                            history: { ...(t.history || {}), [todayStr]: completedStatus }
                        };
                    } else {
                        const newCompleted = !t.completed;
                        return {
                            ...t,
                            completed: newCompleted,
                            history: { ...(t.history || {}), [todayStr]: newCompleted }
                        };
                    }
                }));
            };

            const handleSaveTask = (taskData) => {
                const todayStr = getTodayStr();
                const baseTask = {
                    ...taskData,
                    dailyTarget: taskData.dailyTarget || 1,
                    unit: taskData.unit || 'Ê¨°',
                    stepValue: taskData.stepValue || 1,
                    dailyProgress: taskData.type === 'quantitative' ? (taskData.dailyProgress || { [todayStr]: { value: 0, completed: false } }) : {},
                    completed: taskData.type !== 'quantitative' ? false : taskData.completed,
                    history: taskData.history || {}
                };

                if (editingTask) {
                    setTasks(prev => prev.map(t => t.id === editingTask.id ? { ...baseTask, id: t.id } : t));
                } else {
                    setTasks(prev => [...prev, { ...baseTask, id: generateId() }]);
                }
                setIsFormModalOpen(false);
                setEditingTask(null);
            };

            const handleDeleteTask = (taskId) => {
                if (window.confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§Ê≠§‰ªªÂãôÂóéÔºü')) {
                    setTasks(prev => prev.filter(t => t.id !== taskId));
                    setIsFormModalOpen(false);
                    setEditingTask(null);
                }
            };

            // Group Tasks
            const dailyTasks = tasks.filter(t => t.frequency === 'daily');
            const weeklyTasks = tasks.filter(t => t.frequency === 'weekly');
            const monthlyTasks = tasks.filter(t => t.frequency === 'monthly');

            return (
                <div className="bg-gray-50 min-h-screen font-sans flex flex-col md:flex-row max-w-[420px] mx-auto border-x border-gray-200 shadow-2xl">

                    {/* Main Content Area */}
                    <main className="flex-1 flex flex-col h-screen overflow-hidden relative">
                        <AppHeader
                            onViewChange={setCurrentView}
                            currentView={currentView}
                            onOpenAddFlow={() => setIsLibraryModalOpen(true)}
                            onOpenBadges={() => alert('ÊàêÂ∞±Á≥ªÁµ±Âç≥Â∞áÊé®Âá∫ÔºÅ')}
                        />

                        <div className="flex-1 overflow-y-auto p-4 md:p-6 pb-24 no-scrollbar">

                            {currentView === 'daily' && (
                                <div className="animate-fade-in-up">
                                    <DashboardSummaryCard tasks={tasks} onOpenDetail={() => setCurrentView('dashboard_detail')} />

                                    <div className="space-y-6">
                                        {/* Daily Section */}
                                        <div>
                                            <h2 className="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                                <Sun size={20} className="text-orange-500" /> ‰ªäÊó•‰ªªÂãô
                                            </h2>
                                            <div className="space-y-3">
                                                {dailyTasks.map(task => (
                                                    <TaskCard
                                                        key={task.id}
                                                        task={task}
                                                        onClick={() => { setEditingTask(task); setIsFormModalOpen(true); }}
                                                        onUpdate={handleUpdateProgress}
                                                    />
                                                ))}
                                                {dailyTasks.length === 0 && <p className="text-gray-400 text-sm text-center py-4">‰ªäÂ§©Ê≤íÊúâ‰ªªÂãôÔºåÂéªÊñ∞Â¢û‰∏ÄÂÄãÂêßÔºÅ</p>}
                                            </div>
                                        </div>

                                        {/* Weekly Section */}
                                        {weeklyTasks.length > 0 && (
                                            <div>
                                                <h2 className="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                                    <Calendar size={20} className="text-blue-500" /> Êú¨ÈÄ±ÁõÆÊ®ô
                                                </h2>
                                                <div className="space-y-3">
                                                    {weeklyTasks.map(task => (
                                                        <TaskCard
                                                            key={task.id}
                                                            task={task}
                                                            onClick={() => { setEditingTask(task); setIsFormModalOpen(true); }}
                                                            onUpdate={handleUpdateProgress}
                                                        />
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {/* Monthly Section */}
                                        {monthlyTasks.length > 0 && (
                                            <div>
                                                <h2 className="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                                    <Target size={20} className="text-purple-500" /> Êú¨ÊúàÊåëÊà∞
                                                </h2>
                                                <div className="space-y-3">
                                                    {monthlyTasks.map(task => (
                                                        <TaskCard
                                                            key={task.id}
                                                            task={task}
                                                            onClick={() => { setEditingTask(task); setIsFormModalOpen(true); }}
                                                            onUpdate={handleUpdateProgress}
                                                        />
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {currentView === 'dashboard_detail' && (
                                <DashboardDetailView tasks={tasks} />
                            )}

                        </div>

                        {/* Modals */}
                        <TaskFormModal
                            isOpen={isFormModalOpen}
                            onClose={() => { setIsFormModalOpen(false); setEditingTask(null); }}
                            onSave={handleSaveTask}
                            onDelete={handleDeleteTask}
                            initialData={editingTask}
                        />

                        <TaskLibraryModal
                            isOpen={isLibraryModalOpen}
                            onClose={() => setIsLibraryModalOpen(false)}
                            onSelectTask={(task) => { handleSaveTask({ ...task, id: generateId() }); setIsLibraryModalOpen(false); }}
                            onOpenCustomForm={() => { setIsLibraryModalOpen(false); setIsFormModalOpen(true); }}
                        />

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

</body>

</html>